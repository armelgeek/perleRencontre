{% extends 'base.html.twig' %}

{% block title %}Hello AbonnementController!
{% endblock %}

{% block body %}
	<style>
		.example-wrapper {
			margin: 1em auto;
			max-width: 800px;
			width: 95%;
			font: 18px / 1.5 sans-serif;
		}
		.example-wrapper code {
			background: #F5F5F5;
			padding: 2px 6px;
		}
	</style>

	<div class="example-wrapper">
		{% if error %}
			<div class="alert alert-danger alert-dismissible fade show" role="alert">
				<button type="button" class="close" data-dismiss="alert" aria-label="Close">
					<span aria-hidden="true">&times;</span>
					<span class="sr-only">Close</span>
				</button>
				<strong>{{error.type}} - {{error.status}} : {{error.code}} </strong> {{error.message}}
			</div>
		{% endif %}
		<form method="post" id="payment-form">
			<div class="form-row">
				<label for="card-element">
					Credit or debit card
				</label>
				<div id="card-element"></div>
				<div class="form-group">
					<div class="col-md-6">
						<input type="number" name="price" placeholder="Euro" class="form-control" required>
					</div>
				</div>
				<div class="form-group">
					<div class="col-md-6">
						<input type="number" placeholder="Nombre" name="validation_number" class="form-control" value="1" required>
					</div>
				</div>
				<div class="form-group">
					<div class="col-md-6">
						<textarea name="description" id="description" cols="30" rows="10" class="form-control"></textarea>
					</div>
				</div>
				<div id="card-errors" role="alert"></div>
			</div>

			<button>Submit Payment</button>
		</form>
	</div>
{% endblock %}
{% block javascripts %}

	<script src="https://js.stripe.com/v3/"></script>
	<script>

		function stripeTokenHandler(token) {
            var form = document.getElementById('payment-form');
            var hiddenInput = document.createElement('input');
            hiddenInput.setAttribute('type', 'hidden');
            hiddenInput.setAttribute('name', 'stripeToken');
            hiddenInput.setAttribute('value', token.id);
            form.appendChild(hiddenInput);
            form.submit();
        }

		var stripe = Stripe('{{api_key}}');

        var elements = stripe.elements();
        var style = {
            base: {
                fontSize: '16px',
                color: '#32325d'
            }
        };

        var card = elements.create('card', {style: style});
        card.mount('#card-element');
        var form = document.getElementById('payment-form');
        form.addEventListener('submit', function (event) {
            event.preventDefault();

            stripe.createToken(card).then(function (result) {
                if (result.error) {
                    var errorElement = document.getElementById('card-errors');
                    errorElement.textContent = result.error.message;
                 } else {
                    stripeTokenHandler(result.token);
                 }
             });
        });
	</script>
{% endblock %}
